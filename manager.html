<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manager Dashboard</title>
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: url("LoginBackground.jpg") no-repeat center center fixed;
  background-size: cover;
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}
header {
  background: rgba(255,255,255,0.9);
  padding: 20px;
  width: 100%;
  text-align: center;
  font-size: 22px;
  color: #007f5f;
  font-weight: 600;
}
.container {
  background: rgba(255,255,255,0.9);
  margin-top: 40px;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  width: 90%;
  max-width: 900px;
  margin-bottom: 30px;
}
h2 { text-align: center; color: #007f5f; margin-bottom: 20px; }
form { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; justify-content: center; }
input, select { padding: 10px; border-radius: 8px; border: 1px solid #ccc; width: 200px; }
button { background: linear-gradient(135deg,#00a86b,#007f5f); color:white; border:none; padding:10px 20px; cursor:pointer; }
button:hover { background: linear-gradient(135deg,#00b874,#009e63); transform: translateY(-2px); }
table { width: 100%; border-collapse: collapse; text-align: center; margin-bottom:20px; }
th, td { padding: 12px; border-bottom: 1px solid #ccc; }
th { background: #00a86b; color: white; }
td button { padding: 6px 10px; margin:0 3px; font-size:14px; }
#noNeeds, #noRequests { text-align: center; color: gray; margin-top:20px; font-style: italic; }
footer { margin-top:auto; text-align:center; padding:10px; color:white; }
</style>
</head>
<body>
<header>U-Fund Manager Dashboard</header>

<div class="container">
  <h2>Manage Needs</h2>
  <button id="logoutBtn" style="background:#ff4d4d;margin-bottom:15px;">Logout</button>
  <form id="needForm">
    <input type="text" id="needName" placeholder="Need Name" required>
    <input type="text" id="needDesc" placeholder="Description" required>
    <select id="needCategory" required>
      <option value="">Category</option>
      <option value="Education">Education</option>
      <option value="Health">Health</option>
      <option value="Food">Food</option>
      <option value="Other">Other</option>
    </select>
    <input type="number" id="needAmount" placeholder="Amount (AED)" required>
    <button type="submit">Add Need</button>
  </form>

  <table id="needsTable">
    <thead>
      <tr><th>Name</th><th>Description</th><th>Category</th><th>Amount</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <p id="noNeeds">No needs added yet.</p>
</div>

<div class="container">
  <h2>User Requests</h2>
  <table id="requestsTable">
    <thead>
      <tr><th>User</th><th>Need</th><th>Amount</th><th>Status</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <p id="noRequests">No requests available.</p>
</div>

<footer>Â© 2025 NeedsConnect | Manager Portal</footer>

<script>
document.getElementById("logoutBtn").addEventListener("click", () => {
  localStorage.removeItem("user");
  window.location.href = "login.html";
});

window.onload = function() {
  const loggedUser = localStorage.getItem("user");
  if (loggedUser !== "admin") {
    alert("Access denied. Only manager (admin) can view this page.");
    window.location.href = "login.html";
    return;
  }

  // --- Manage Needs ---
  let needs = JSON.parse(localStorage.getItem("needs")) || [];
  const needsTableBody = document.querySelector("#needsTable tbody");
  const noNeedsMsg = document.getElementById("noNeeds");
  const needForm = document.getElementById("needForm");

  function displayNeeds() {
    needsTableBody.innerHTML = "";
    if (needs.length === 0) {
      noNeedsMsg.style.display = "block";
      return;
    }
    noNeedsMsg.style.display = "none";
    needs.forEach((n,i)=>{
      const row = document.createElement("tr");
      row.innerHTML = `<td>${n.name}</td><td>${n.desc}</td><td>${n.category}</td><td>${n.amount}</td>
        <td><button onclick="editNeed(${i})">Edit</button><button onclick="deleteNeed(${i})">Remove</button></td>`;
      needsTableBody.appendChild(row);
    });
  }

  needForm.addEventListener("submit", e=>{
    e.preventDefault();
    const newNeed = {
      name: needForm.needName.value,
      desc: needForm.needDesc.value,
      category: needForm.needCategory.value,
      amount: needForm.needAmount.value
    };
    needs.push(newNeed);
    localStorage.setItem("needs", JSON.stringify(needs));
    needForm.reset();
    displayNeeds();
  });

  window.editNeed = function(index){
    const n = needs[index];
    needForm.needName.value = n.name;
    needForm.needDesc.value = n.desc;
    needForm.needCategory.value = n.category;
    needForm.needAmount.value = n.amount;
    needs.splice(index,1);
    localStorage.setItem("needs", JSON.stringify(needs));
    displayNeeds();
  };

  window.deleteNeed = function(index){
    if(confirm("Remove this need?")){
      needs.splice(index,1);
      localStorage.setItem("needs", JSON.stringify(needs));
      displayNeeds();
    }
  };

  displayNeeds();

  // --- Manage Requests ---
  let requests = JSON.parse(localStorage.getItem("requests")) || [];
  const requestsTableBody = document.querySelector("#requestsTable tbody");
  const noRequestsMsg = document.getElementById("noRequests");

  function displayRequests() {
    requestsTableBody.innerHTML = "";
    if(requests.length === 0){
        noRequestsMsg.style.display = "block";
        return;
    }
    noRequestsMsg.style.display = "none";
    requests.forEach((r,i)=>{
        const row = document.createElement("tr");
        row.innerHTML = `<td>${r.requestUser}</td>
                         <td>${r.name}</td>
                         <td>${r.amount}</td>
                         <td id="status-${i}">${r.status}</td>
                         <td>
                           <button onclick="handleRequest(${i},'Accepted')">Accept</button>
                           <button onclick="handleRequest(${i},'Declined')">Decline</button>
                           <button onclick="deleteRequest(${i})" style="background:#ff4d4d; color:white; margin-left:5px;">Remove</button>
                         </td>`;
        requestsTableBody.appendChild(row);
    });
  }

  window.handleRequest = function(index, newStatus){
    requests[index].status = newStatus;
    localStorage.setItem("requests", JSON.stringify(requests));

    let notifications = JSON.parse(localStorage.getItem("notifications")) || [];
    notifications.push({
        user: requests[index].requestUser,
        message: `Your request for "${requests[index].name}" has been ${newStatus.toLowerCase()}.`,
        read: false
    });
    localStorage.setItem("notifications", JSON.stringify(notifications));

    displayRequests();
  }

  window.deleteRequest = function(index){
    if(confirm("Remove this request?")){
        requests.splice(index, 1);
        localStorage.setItem("requests", JSON.stringify(requests));
        displayRequests();
    }
  }

  displayRequests();
};
</script>
</body>
</html>
